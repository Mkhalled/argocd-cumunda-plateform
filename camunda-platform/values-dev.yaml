# Configuration Camunda 8 pour environnement DEV
# Adapt√© aux standards d'entreprise

#######################################################
# Labels standards (similaire √† votre backend)
#######################################################
labels:
  appcode: üî¥ APxxxxx # üî¥ √Ä MODIFIER selon votre projet Camunda
  appshortname: üî¥ CAMUNDA8-PLATFORM # üî¥ √Ä MODIFIER
  env: dev
  # A, P or PA with P for Presentation and A for API
  tier: A
  opscontact: üî¥ votre_equipe_ops@votre-entreprise.com # üî¥ √Ä MODIFIER
  # component: java, dotnet, php or python
  component: java
  function: workflow-engine
  # Version stable or canary
  version: stable
  ecosystem: üî¥ ecXXXiXXXXXX # üî¥ Depuis .env_vars > nprd.default.ecosystem
  rollout: "true"
  inservice: "false"

  # Kubernetes cluster info
  k8s_cluster: üî¥ kuXXXiXXXXXX # üî¥ Depuis .env_vars > nprd.default.cluster
  k8s_namespace: üî¥ nsXXXiXXXXXX # üî¥ Depuis .env_vars > nprd.envs.dev.namespace

  laas_dmzr_apcode: üî¥ apxxxxx # üî¥ √Ä MODIFIER
  laas_dmzr_dataset: camundalogs # üî¥ √Ä MODIFIER
  laas_dmzr_env: dev

#######################################################
# Configuration globale Camunda 8
#######################################################
global:
  image:
    pullPolicy: Always # Conforme √† vos standards

  # Labels appliqu√©s √† tous les composants
  labels:
    appcode: üî¥ APxxxxx # üî¥ √Ä MODIFIER
    env: dev
    ecosystem: üî¥ ecXXXiXXXXXX

  # Ingress
  ingress:
    enabled: true
    className: nginx
    host: "üî¥ camunda-dev.votre-domaine.com" # üî¥ √Ä MODIFIER
    tls:
      enabled: true
      secretName: camunda-dev-tls

#######################################################
# Zeebe - Moteur de workflow
#######################################################
zeebe:
  clusterSize: 1 # 1 seul n≈ìud en DEV
  partitionCount: 2
  replicationFactor: 1

  image:
    pullPolicy: Always

  # Labels sp√©cifiques
  labels:
    function: zeebe-broker
    component: java

  # Variables d'environnement
  env:
    - name: JAVA_OPTS
      value: "-Xms512m -Xmx1g -XX:+UseG1GC"
    - name: ZEEBE_BROKER_EXECUTION_METRICS_EXPORTER_ENABLED
      value: "true"

  # Ressources (adapt√©es √† DEV)
  resources:
    requests:
      cpu: 750m
      memory: 1.5Gi
    limits:
      cpu: 750m # Match CPU request comme votre backend
      memory: 1.5Gi

  # Security Context (conforme √† vos standards)
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1001
    runAsGroup: 1001
    fsGroup: 1001

  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop: ["ALL"]
    seccompProfile:
      type: RuntimeDefault
    runAsNonRoot: true
    runAsUser: 1001
    runAsGroup: 1001

  # Probes (similaire √† votre backend)
  startupProbe:
    periodSeconds: 10
    failureThreshold: 60
    timeoutSeconds: 30

  readinessProbe:
    periodSeconds: 10
    timeoutSeconds: 30

  livenessProbe:
    periodSeconds: 10
    timeoutSeconds: 30

  # Persistence
  pvcSize: 10Gi
  pvcAccessModes: ["ReadWriteOnce"]
  pvcStorageClassName: "" # üî¥ √Ä d√©finir selon votre cluster

#######################################################
# Zeebe Gateway - Point d'entr√©e API
#######################################################
zeebe-gateway:
  replicas: 1

  image:
    pullPolicy: Always

  labels:
    function: zeebe-gateway
    component: java

  env:
    - name: JAVA_OPTS
      value: "-Xms256m -Xmx512m"

  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Security Context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1001
    runAsGroup: 1001

  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop: ["ALL"]
    seccompProfile:
      type: RuntimeDefault
    runAsNonRoot: true
    runAsUser: 1001

  # Service
  service:
    type: ClusterIP
    httpPort: 8080
    grpcPort: 26500

  # Ingress
  ingress:
    enabled: true
    className: nginx
    host: "üî¥ zeebe-gateway-dev.votre-domaine.com" # üî¥ √Ä MODIFIER
    tls:
      enabled: true
      secretName: zeebe-gateway-tls

#######################################################
# Operate - Interface de monitoring
#######################################################
operate:
  enabled: true

  image:
    pullPolicy: Always

  labels:
    function: operate-ui
    component: java

  env:
    - name: JAVA_OPTS
      value: "-Xms256m -Xmx512m"

  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Security Context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1001
    runAsGroup: 1001

  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop: ["ALL"]
    seccompProfile:
      type: RuntimeDefault
    runAsNonRoot: true
    runAsUser: 1001

  # Probes
  startupProbe:
    periodSeconds: 10
    failureThreshold: 60
    timeoutSeconds: 30

  readinessProbe:
    httpGet:
      path: /health
      port: http
      scheme: HTTP
    periodSeconds: 10
    timeoutSeconds: 30

  livenessProbe:
    httpGet:
      path: /health
      port: http
      scheme: HTTP
    periodSeconds: 10
    timeoutSeconds: 30

  ingress:
    enabled: true
    className: nginx
    host: "üî¥ operate-dev.votre-domaine.com" # üî¥ √Ä MODIFIER
    tls:
      enabled: true
      secretName: operate-tls

#######################################################
# Tasklist - Interface des t√¢ches utilisateur
#######################################################
tasklist:
  enabled: true

  image:
    pullPolicy: Always

  labels:
    function: tasklist-ui
    component: java

  env:
    - name: JAVA_OPTS
      value: "-Xms256m -Xmx512m"

  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Security Context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1001
    runAsGroup: 1001

  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop: ["ALL"]
    seccompProfile:
      type: RuntimeDefault
    runAsNonRoot: true
    runAsUser: 1001

  # Probes
  startupProbe:
    periodSeconds: 10
    failureThreshold: 60
    timeoutSeconds: 30

  readinessProbe:
    httpGet:
      path: /health
      port: http
      scheme: HTTP
    periodSeconds: 10
    timeoutSeconds: 30

  livenessProbe:
    httpGet:
      path: /health
      port: http
      scheme: HTTP
    periodSeconds: 10
    timeoutSeconds: 30

  ingress:
    enabled: true
    className: nginx
    host: "üî¥ tasklist-dev.votre-domaine.com" # üî¥ √Ä MODIFIER
    tls:
      enabled: true
      secretName: tasklist-tls

#######################################################
# Optimize - Analyse (d√©sactiv√© en DEV par d√©faut)
#######################################################
optimize:
  enabled: false # Activer si n√©cessaire

#######################################################
# Connectors - Int√©grations (d√©sactiv√© en DEV)
#######################################################
connectors:
  enabled: false # Activer si n√©cessaire

#######################################################
# Identity - Authentification (simplifi√© en DEV)
#######################################################
identity:
  enabled: false # Activer pour g√©rer l'authentification centralis√©e

#######################################################
# Elasticsearch - Base de donn√©es
#######################################################
elasticsearch:
  enabled: true

  image:
    pullPolicy: Always

  # D√©ploiement simplifi√© pour DEV
  master:
    replicaCount: 1

  data:
    replicaCount: 1

  coordinating:
    replicaCount: 1

  resources:
    requests:
      cpu: 750m
      memory: 1.5Gi
    limits:
      cpu: 750m
      memory: 1.5Gi

  # Security Context
  securityContext:
    enabled: true
    runAsUser: 1001
    runAsGroup: 1001
    fsGroup: 1001

  containerSecurityContext:
    enabled: true
    allowPrivilegeEscalation: false
    capabilities:
      drop: ["ALL"]
    runAsNonRoot: true
    runAsUser: 1001

  # Persistence
  volumeClaimTemplate:
    resources:
      requests:
        storage: 15Gi
    storageClassName: "" # üî¥ √Ä d√©finir selon votre cluster
    accessModes: ["ReadWriteOnce"]

#######################################################
# PostgreSQL - Base de donn√©es (optionnel)
#######################################################
# Si vous voulez utiliser PostgreSQL au lieu d'Elasticsearch
# pour certains composants (Identity, etc.)
postgresql:
  enabled: false # Activer si n√©cessaire

  auth:
    database: camunda
    username: camunda_user
    # Password sera inject√© via Vault

  primary:
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 512Mi

    # Security Context
    containerSecurityContext:
      enabled: true
      allowPrivilegeEscalation: false
      capabilities:
        drop: ["ALL"]
      runAsNonRoot: true
      runAsUser: 1001

    persistence:
      enabled: true
      size: 10Gi
      storageClass: "" # üî¥ √Ä d√©finir

#######################################################
# Init container HashiCorp Vault (si n√©cessaire)
#######################################################
# Configuration Vault similaire √† votre backend
# √Ä d√©commenter et adapter si vous utilisez Vault pour les secrets

# vault:
#   enabled: true
#   namespace: üî¥ VOTRE_NAMESPACE/VAULT  # üî¥ √Ä MODIFIER
#   cluster:
#     name: üî¥ kuXXXiXXXXXX  # üî¥ √Ä MODIFIER
#   image:
#     name: vault
#     tag: 1.6.3
#     pullPolicy: IfNotPresent
#   log:
#     level: info
#   securityContext:
#     allowPrivilegeEscalation: false
#     capabilities:
#       drop: ["ALL"]
#     runAsUser: 1001
#     runAsGroup: 1001
#
#   # Secrets √† r√©cup√©rer depuis Vault
#   raw_secrets:
#     - destination_file: camunda-secrets.yaml
#       vault_template: |
#         {{- with secret "secret/data/üî¥apxxxxx/dev/camunda/applis" }}
#         {{ .Data.data }}
#         {{- end }}

#######################################################
# Notes de configuration
#######################################################
# üî¥ √Ä MODIFIER avant d√©ploiement:
# 1. labels.appcode - Code application Camunda
# 2. labels.appshortname - Nom court du projet
# 3. labels.opscontact - Contact √©quipe ops
# 4. labels.ecosystem - Code ecosystem si diff√©rent
# 5. *.ingress.host - Domaines selon votre environnement
# 6. StorageClass - Classes de stockage de votre cluster
# 7. Vault namespace et paths - Si utilisation de Vault
#
# ‚ö†Ô∏è Cette configuration suit vos standards:
# - SecurityContext strict (runAsNonRoot, drop ALL capabilities)
# - Probes configur√©es (startup, readiness, liveness)
# - Labels standardis√©s
# - Resources requests = limits pour CPU
# - Image pullPolicy: Always
