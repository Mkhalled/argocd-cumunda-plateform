<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions
  xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
  xmlns:zeebe="http://camunda.org/schema/zeebe/1.0"
  id="Definitions_1"
  targetNamespace="http://bpmn.io/schema/bpmn">

  <bpmn:process id="AX_Quotation_Contract_Process" name="AX Quotation & Contract Process" isExecutable="true">

    <!-- START -->
    <bpmn:startEvent id="StartEvent" name="BG/LE Selected"/>

    <!-- CHECK RIGHTS -->
    <bpmn:exclusiveGateway id="Gateway_CheckRights" name="Has Admin Rights?"/>

    <!-- ACCESS DENIED -->
    <bpmn:endEvent id="End_AccessDenied" name="Access Denied"/>

    <!-- CHOOSE ACTION -->
    <bpmn:userTask id="UserTask_ChooseAction" name="Choose Action"/>

    <bpmn:exclusiveGateway id="Gateway_Action" name="Selected Action?"/>

    <!-- ========== QUOTATION FLOW ========== -->
    <bpmn:userTask id="UserTask_FillForm" name="Fill Question Form"/>
    <bpmn:exclusiveGateway id="Gateway_FormValid" name="Form Complete?"/>
    <bpmn:serviceTask id="ServiceTask_GenerateOffer" name="Generate Proposed Offer"/>
    <bpmn:userTask id="UserTask_SelectOffer" name="Select Proposed Offer"/>
    <bpmn:exclusiveGateway id="Gateway_OfferAccepted" name="Offer Accepted?"/>
    <bpmn:serviceTask id="ServiceTask_GenerateQuotation" name="Generate Quotation"/>
    <bpmn:serviceTask id="ServiceTask_SaveQuotation" name="Save Quotation"/>
    <bpmn:endEvent id="End_Quotation" name="Quotation Created"/>

    <!-- ========== CONTRACT FLOW ========== -->
    <bpmn:userTask id="UserTask_FillCustomer" name="Fill Customer Info"/>
    <bpmn:userTask id="UserTask_RecapCustomer" name="Recap Customer Info"/>
    <bpmn:userTask id="UserTask_RecapOffer" name="Recap Offer Info"/>
    <bpmn:exclusiveGateway id="Gateway_ContractValid" name="Validation OK?"/>
    <bpmn:serviceTask id="ServiceTask_GenerateContract" name="Generate Contract"/>
    <bpmn:serviceTask id="ServiceTask_SaveContract" name="Save Contract"/>
    <bpmn:endEvent id="End_Contract" name="Contract Created"/>

    <!-- ========== OPEN EXISTING FLOW ========== -->
    <bpmn:serviceTask id="ServiceTask_LoadExisting" name="Load Existing"/>
    <bpmn:userTask id="UserTask_EditExisting" name="View / Edit"/>
    <bpmn:serviceTask id="ServiceTask_SaveExisting" name="Save Existing"/>
    <bpmn:endEvent id="End_Existing" name="Process Ended"/>

    <!-- SEQUENCE FLOWS -->
    <bpmn:sequenceFlow id="flow1" sourceRef="StartEvent" targetRef="Gateway_CheckRights"/>

    <bpmn:sequenceFlow id="flow2" sourceRef="Gateway_CheckRights" targetRef="UserTask_ChooseAction">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">hasAdminRights == true</bpmn:conditionExpression>
    </bpmn:sequenceFlow>

    <bpmn:sequenceFlow id="flow3" sourceRef="Gateway_CheckRights" targetRef="End_AccessDenied"/>

    <bpmn:sequenceFlow id="flow4" sourceRef="UserTask_ChooseAction" targetRef="Gateway_Action"/>

    <!-- QUOTATION -->
    <bpmn:sequenceFlow id="flow5" sourceRef="Gateway_Action" targetRef="UserTask_FillForm"/>
    <bpmn:sequenceFlow id="flow6" sourceRef="UserTask_FillForm" targetRef="Gateway_FormValid"/>
    <bpmn:sequenceFlow id="flow7" sourceRef="Gateway_FormValid" targetRef="UserTask_FillForm"/>
    <bpmn:sequenceFlow id="flow8" sourceRef="Gateway_FormValid" targetRef="ServiceTask_GenerateOffer"/>
    <bpmn:sequenceFlow id="flow9" sourceRef="ServiceTask_GenerateOffer" targetRef="UserTask_SelectOffer"/>
    <bpmn:sequenceFlow id="flow10" sourceRef="UserTask_SelectOffer" targetRef="Gateway_OfferAccepted"/>
    <bpmn:sequenceFlow id="flow11" sourceRef="Gateway_OfferAccepted" targetRef="UserTask_FillForm"/>
    <bpmn:sequenceFlow id="flow12" sourceRef="Gateway_OfferAccepted" targetRef="ServiceTask_GenerateQuotation"/>
    <bpmn:sequenceFlow id="flow13" sourceRef="ServiceTask_GenerateQuotation" targetRef="ServiceTask_SaveQuotation"/>
    <bpmn:sequenceFlow id="flow14" sourceRef="ServiceTask_SaveQuotation" targetRef="End_Quotation"/>

    <!-- CONTRACT -->
    <bpmn:sequenceFlow id="flow15" sourceRef="Gateway_Action" targetRef="UserTask_FillCustomer"/>
    <bpmn:sequenceFlow id="flow16" sourceRef="UserTask_FillCustomer" targetRef="UserTask_RecapCustomer"/>
    <bpmn:sequenceFlow id="flow17" sourceRef="UserTask_RecapCustomer" targetRef="UserTask_RecapOffer"/>
    <bpmn:sequenceFlow id="flow18" sourceRef="UserTask_RecapOffer" targetRef="Gateway_ContractValid"/>
    <bpmn:sequenceFlow id="flow19" sourceRef="Gateway_ContractValid" targetRef="UserTask_FillCustomer"/>
    <bpmn:sequenceFlow id="flow20" sourceRef="Gateway_ContractValid" targetRef="ServiceTask_GenerateContract"/>
    <bpmn:sequenceFlow id="flow21" sourceRef="ServiceTask_GenerateContract" targetRef="ServiceTask_SaveContract"/>
    <bpmn:sequenceFlow id="flow22" sourceRef="ServiceTask_SaveContract" targetRef="End_Contract"/>

    <!-- OPEN EXISTING -->
    <bpmn:sequenceFlow id="flow23" sourceRef="Gateway_Action" targetRef="ServiceTask_LoadExisting"/>
    <bpmn:sequenceFlow id="flow24" sourceRef="ServiceTask_LoadExisting" targetRef="UserTask_EditExisting"/>
    <bpmn:sequenceFlow id="flow25" sourceRef="UserTask_EditExisting" targetRef="ServiceTask_SaveExisting"/>
    <bpmn:sequenceFlow id="flow26" sourceRef="ServiceTask_SaveExisting" targetRef="End_Existing"/>

  </bpmn:process>
</bpmn:definitions>
