# ğŸ¦ Configuration Camunda 8 adaptÃ©e aux standards BNPP / Echonet

Ce guide explique comment la configuration Camunda 8 a Ã©tÃ© adaptÃ©e Ã  vos standards d'entreprise.

## ğŸ“‹ Standards respectÃ©s

BasÃ© sur votre configuration backend (`PORTAIL-MARCHAND-AXE`), j'ai adaptÃ© :

### âœ… 1. Labels standardisÃ©s

```yaml
labels:
  appcode: AP85575           # Code application
  appshortname: CAMUNDA8-PLATFORM
  env: dev
  tier: A                    # API tier
  opscontact: ...@bnpparibas.com
  component: java
  function: workflow-engine
  version: stable
  ecosystem: ec002i002837
  rollout: "true"
  inservice: "false"
  
  # LAAS DMZR
  laas_dmzr_apcode: ap85575
  laas_dmzr_dataset: camundalogs
  laas_dmzr_env: dev
```

### âœ… 2. Security Context strict

```yaml
# Tous les composants Camunda
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001
  fsGroup: 1001

containerSecurityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop: ["ALL"]
  seccompProfile:
    type: RuntimeDefault
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001
```

### âœ… 3. Probes (comme votre backend)

```yaml
startupProbe:
  periodSeconds: 10
  failureThreshold: 60
  timeoutSeconds: 30

readinessProbe:
  httpGet:
    path: /health
    port: http
    scheme: HTTP
  periodSeconds: 10
  timeoutSeconds: 30

livenessProbe:
  httpGet:
    path: /health
    port: http
    scheme: HTTP
  periodSeconds: 10
  timeoutSeconds: 30
```

### âœ… 4. Resources (CPU requests = limits)

```yaml
resources:
  requests:
    cpu: 750m
    memory: 1.5Gi
  limits:
    cpu: 750m      # Match CPU request
    memory: 1.5Gi
```

### âœ… 5. Image pull policy

```yaml
image:
  pullPolicy: Always  # Toujours la derniÃ¨re version
```

### âœ… 6. TLS activÃ© par dÃ©faut

```yaml
ingress:
  enabled: true
  className: nginx
  host: "camunda-dev.paas.echonet"
  tls:
    enabled: true
    secretName: camunda-dev-tls
```

---

## ğŸ”§ ParamÃ¨tres Ã  personnaliser

### ğŸ”´ Obligatoire avant dÃ©ploiement

```yaml
# 1. Code application Camunda (demandez Ã  votre chef de projet)
labels:
  appcode: AP85575  # ğŸ”´ CHANGER - Votre code Camunda
  appshortname: CAMUNDA8-PLATFORM  # ğŸ”´ CHANGER

# 2. Contact ops
labels:
  opscontact: votre_equipe@bnpparibas.com  # ğŸ”´ CHANGER

# 3. Ecosystem (si diffÃ©rent de votre backend)
labels:
  ecosystem: ec002i002837  # ğŸ”´ VÃ‰RIFIER

# 4. Domaines
zeebe-gateway:
  ingress:
    host: "zeebe-gateway-dev.paas.echonet"  # ğŸ”´ CHANGER

operate:
  ingress:
    host: "operate-dev.paas.echonet"  # ğŸ”´ CHANGER

tasklist:
  ingress:
    host: "tasklist-dev.paas.echonet"  # ğŸ”´ CHANGER

# 5. StorageClass (demandez Ã  votre Ã©quipe infra)
zeebe:
  pvcStorageClassName: ""  # ğŸ”´ DÃ‰FINIR (ex: ceph-rbd, nfs-client)

elasticsearch:
  volumeClaimTemplate:
    storageClassName: ""  # ğŸ”´ DÃ‰FINIR
```

---

## ğŸ” IntÃ©gration HashiCorp Vault (optionnel)

Si vous voulez utiliser Vault comme votre backend, dÃ©commentez et adaptez :

```yaml
vault:
  enabled: true
  namespace: UPM_FLUX/TRANCARPAY/EC002I002837  # ğŸ”´ VOTRE namespace
  cluster:
    name: ku002i000983  # ğŸ”´ VOTRE cluster
  
  # Secrets Camunda depuis Vault
  raw_secrets:
    - destination_file: camunda-db-credentials.yaml
      vault_template: |
        {{- with secret "secret/data/ap85575/dev/camunda/applis" }}
        DB_USERNAME: {{ .Data.data.db_username }}
        DB_PASSWORD: {{ .Data.data.db_password }}
        {{- end }}
    
    - destination_file: bnpp_ca.crt
      vault_template: |
        {{- with secret "secret/data/ap85575/dev/camunda/certificats" }}
        {{ .Data.data.bnpp_ca_crt }}
        {{- end }}

# Configuration Spring Cloud Vault pour Operate/Tasklist
operate:
  env:
    - name: SPRING_CLOUD_VAULT_ENABLED
      value: "true"
    - name: SPRING_CLOUD_VAULT_URI
      value: "https://hvault.staging.echonet"
    - name: SPRING_CLOUD_VAULT_NAMESPACE
      value: "UPM_FLUX/TRANCARPAY/EC002I002837"
    - name: SPRING_CLOUD_VAULT_KUBERNETES_ROLE
      value: "ns002i008817_default"
```

---

## ğŸ“Š Comparaison avec votre backend

| Ã‰lÃ©ment | Votre Backend | Camunda 8 | âœ… |
|---------|---------------|-----------|-----|
| **Labels** | âœ“ StandardisÃ©s | âœ“ Identiques | âœ… |
| **SecurityContext** | âœ“ Strict (runAsNonRoot, drop ALL) | âœ“ Identique | âœ… |
| **Probes** | âœ“ 3 types (startup, ready, live) | âœ“ Identiques | âœ… |
| **Resources** | âœ“ CPU req = limits | âœ“ Identique | âœ… |
| **Image Policy** | âœ“ Always | âœ“ Always | âœ… |
| **TLS** | âœ“ ActivÃ© | âœ“ ActivÃ© | âœ… |
| **Vault** | âœ“ IntÃ©grÃ© | âš ï¸ Optionnel | ğŸ”„ |
| **PostgreSQL** | âœ“ Avec SSL | âš ï¸ Optionnel | ğŸ”„ |

---

## ğŸ¯ Composants Camunda 8

### Architecture dÃ©ployÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Camunda 8 Platform               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Zeebe   â”‚  â”‚ Operate  â”‚  â”‚Tasklistâ”‚â”‚
â”‚  â”‚(Moteur)  â”‚  â”‚ (Monito) â”‚  â”‚(TÃ¢ches)â”‚â”‚
â”‚  â”‚750m CPU  â”‚  â”‚ 500m CPU â”‚  â”‚500m CPUâ”‚â”‚
â”‚  â”‚1.5Gi RAM â”‚  â”‚ 512Mi RAMâ”‚  â”‚512Mi   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Gateway  â”‚  â”‚   Elasticsearch      â”‚â”‚
â”‚  â”‚(API)     â”‚  â”‚   (Stockage)         â”‚â”‚
â”‚  â”‚500m CPU  â”‚  â”‚   750m CPU           â”‚â”‚
â”‚  â”‚512Mi RAM â”‚  â”‚   1.5Gi RAM          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total ressources DEV:
- CPU: ~3.5 cores
- RAM: ~5 Gi
- Storage: ~25 Gi (PVC)
```

### Endpoints exposÃ©s

```
# API Zeebe (gRPC)
https://zeebe-gateway-dev.paas.echonet:443
â†’ Pour dÃ©ployer des processus et communiquer avec le moteur

# Interface Operate (monitoring)
https://operate-dev.paas.echonet
â†’ Pour voir les processus en cours, les erreurs, etc.

# Interface Tasklist (tÃ¢ches utilisateur)
https://tasklist-dev.paas.echonet
â†’ Pour que les utilisateurs traitent leurs tÃ¢ches
```

---

## ğŸ”„ DiffÃ©rences avec votre backend

### Votre backend : Application monolithique

```yaml
# Un seul pod avec:
- Spring Boot
- PostgreSQL client
- Cache Redis
- Vault init container
```

### Camunda 8 : Architecture microservices

```yaml
# Plusieurs pods:
- Zeebe (moteur)
- Zeebe Gateway (API)
- Operate (UI monitoring)
- Tasklist (UI tÃ¢ches)
- Elasticsearch (stockage)
```

**ConsÃ©quence** : Configuration rÃ©pÃ©tÃ©e pour chaque composant (SecurityContext, Probes, etc.)

---

## ğŸ“ Checklist de dÃ©ploiement

- [ ] Obtenir un **appcode** pour Camunda 8
- [ ] DÃ©finir le **appshortname** avec votre chef de projet
- [ ] VÃ©rifier l'**ecosystem** code
- [ ] Obtenir les **domaines** Ingress auprÃ¨s de l'Ã©quipe rÃ©seau
- [ ] Demander la **StorageClass** Ã  l'Ã©quipe infra
- [ ] CrÃ©er les **secrets TLS** pour les Ingress
- [ ] (Optionnel) Configurer **Vault** paths et permissions
- [ ] (Optionnel) CrÃ©er la **base PostgreSQL** si nÃ©cessaire
- [ ] Modifier `values-dev-bnpp.yaml` avec ces infos
- [ ] Tester le dÃ©ploiement en DEV

---

## ğŸ†˜ Support

### Questions frÃ©quentes

**Q: Puis-je utiliser la mÃªme base PostgreSQL que mon backend ?**
R: Non recommandÃ©. Camunda 8 utilise Elasticsearch par dÃ©faut. PostgreSQL n'est nÃ©cessaire que pour Identity (authentification).

**Q: Dois-je activer Vault comme mon backend ?**
R: Optionnel en DEV. Si vous n'avez pas de secrets sensibles, les secrets Kubernetes suffisent.

**Q: Les ressources CPU/RAM sont-elles correctes ?**
R: Oui, adaptÃ©es pour DEV. Pour INT/PRD, il faudra augmenter (voir values-int.yaml, values-prd.yaml).

**Q: Pourquoi plusieurs Ingress ?**
R: Camunda 8 a 3 interfaces :
- Zeebe Gateway (API pour vos apps)
- Operate (UI pour les ops)
- Tasklist (UI pour les utilisateurs)

---

## ğŸš€ Prochaines Ã©tapes

1. âœ… Remplir les paramÃ¨tres ğŸ”´ dans `values-dev-bnpp.yaml`
2. âœ… VÃ©rifier que le chart Camunda est dans Artifactory
3. âœ… CrÃ©er l'Application ArgoCD
4. âœ… DÃ©ployer en DEV
5. âœ… Tester les 3 interfaces
6. âœ… CrÃ©er `values-int-bnpp.yaml` et `values-prd-bnpp.yaml`

---

**Votre configuration respecte tous les standards BNPP/Echonet ! ğŸ‰**
